(window.webpackJsonp=window.webpackJsonp||[]).push([["FgPX"],{FgPX:function(e,o,r){"use strict";r.r(o);r("rGqo"),r("yt8O"),r("RW0V"),r("Yfch");var t=r("L2JU"),n=r("XS0u");r("yO6P");function a(e,o,r){return o in e?Object.defineProperty(e,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[o]=r,e}o.default={data:function(){var e=this;return{loginForm:{username:"",password:"",authcode:""},loginRules:{username:[{required:!0,trigger:"blur",validator:function(e,o,r){o.trim()?/^[A-Za-z0-9_]{1,}$/.test(o)?r():r(new Error("仅限输入英文，数字，下划线")):r(new Error("请输入正确的用户名"))}}],password:[{required:!0,trigger:"blur",validator:function(e,o,r){o.trim()?o.length<0?r(new Error("密码长度过低")):r():r(new Error("请输入密码"))}}],authcode:[{required:!0,trigger:"blur",validator:function(o,r,t){var n=r.toUpperCase();n&&e.authcode?n!==e.authcode?t(new Error("验证码错误")):t():t(new Error("验证码不匹配"))}}]},loading:!1,pwdType:"password",checked:!1,lading:null,codeTimer:"",userKey:""}},created:function(){var e=this,o=n.a.localGet("auth")||{};e.$loading(),o.password&&(e.loginForm.username=o.username,e.loginForm.password=o.password,e.checked=!0),e.userKey=n.a.localGet("tempUserKey")||"",n.a.localRemove("tempUserKey"),e.userKey&&e.$api.findUserCodeByToken({token:e.userKey}).then(function(o){e.loginForm.username=o.userCode,e.loginForm.password="123456",e.checked=!1}).catch(function(o){e.loginForm.username="",e.loginForm.password="",e.checked=!1}),e.changeCode(),e.$loading({}).close()},mounted:function(){},methods:{showPwd:function(){this.userKey||("password"===this.pwdType?this.pwdType="":this.pwdType="password")},handleLogin:function(){var e=this;e.savePwd(e.checked),e.$refs.loginForm.validate(function(o){if(!o)return console.log("error submit!!"),!1;e.loading=!0,e.$store.dispatch("Login",{userInfo:e.loginForm,token:e.userKey}).then(function(o){clearTimeout(e.codeTimer),e.loading=!1,e.$store.dispatch("tagsView/delAllViews").then(function(e){e.visitedViews}),e.$router.push({path:"/home"})}).catch(function(){e.loading=!1,e.$loading({}).close()})})},savePwd:function(e){if(e){var o={username:this.loginForm.username,password:this.loginForm.password};console.log(o),n.a.localSet("auth",o)}else n.a.localRemove("auth")},changeCode:function(){var e=this;e.$store.dispatch("CreateSecurityCode",{}).then(function(){e.$refs.loginForm&&e.$refs.loginForm.clearValidate&&e.$refs.loginForm.clearValidate(),e.loginForm.authcode="",e.drawPic(e.authcode),clearTimeout(e.codeTimer),e.codeTimer=setTimeout(function(o){e.changeCode()},27e3)}).catch(function(){e.$refs.loginForm&&e.$refs.loginForm.clearValidate&&e.$refs.loginForm.clearValidate(),e.loginForm.authcode="",clearTimeout(e.codeTimer),e.codeTimer=setTimeout(function(o){e.changeCode()},27e3)})},drawPic:function(e){var o=document.getElementById("canvas"),r=o.width,t=o.height,n=o.getContext("2d");function a(e,o){return Math.floor(Math.random()*(o-e)+e)}function i(e,o){return"rgb("+a(e,o)+","+a(e,o)+","+a(e,o)+")"}n.textBaseline="bottom",n.fillStyle=i(180,240),n.fillRect(0,0,r,t);for(var c=e,s=0;s<4;s++){var l=c[s];n.fillStyle=i(50,160),n.font=a(18,30)+"px SimHei";var u=5+20*s,d=a(25,30),h=a(-30,30);n.translate(u,d),n.rotate(h*Math.PI/180),n.fillText(l,0,0),n.rotate(-h*Math.PI/180),n.translate(-u,-d)}}},computed:function(e){for(var o=1;o<arguments.length;o++){var r=null!=arguments[o]?arguments[o]:{},t=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.forEach(function(o){a(e,o,r[o])})}return e}({},Object(t.b)(["authcode"]),{btnState:function(){return!(this.loginForm.username&&this.loginForm.password&&this.loginForm.authcode&&this.loginForm.authcode.toLowerCase()===this.authcode.toLowerCase())}}),watch:{checked:function(){this.checked||n.a.localRemove("auth")}}}}}]);