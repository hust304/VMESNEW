(window.webpackJsonp=window.webpackJsonp||[]).push([["LtWL"],{LtWL:function(e,t,a){"use strict";a.r(t);a("rE2o"),a("ioFf"),a("f3/d");var i=a("WIyV"),o=a("1IKD"),l=a("Qe0A"),n=a("wk8/");function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r={components:{customBaseTable:i.a,productTableDialog:o.a},name:"dialog-add",props:["initData","visible"],data:function(){var e=this;return{rules:{typeName:[{required:!0,trigger:"change",validator:function(t,a,i){e.typeData.defaultSelected.length<=0?i(new Error("请选择出库类型")):i()}}],warehouseName:[{required:!0,trigger:"change",message:"请选择仓库"}],deptName:[{required:!0,message:"请选择接收单位",trigger:"change"}],makeName:[{required:!0,message:"请选择制单人",trigger:"change"}]},openDialogName:"",showDialog:!1,inLinVisible:!1,dialogData:{title:"",data:null,tempLable:null},dialogLoading:!1,isVisible:!1,inDialog:!0,temp:{type:"",typeName:"",businessCode:"",warehouseId:"",warehouseName:"",deptId:"",deptName:"",makeId:"",makeName:"",dtlJsonStr:""},tempLable:{},tempQuery:{},tableData:[],orderDtlList:[],productUnit:{},rowData:{},configs:{topBarBtnList:[{name:"选择货品",nameEn:"add",isShow:!0,icon:"add",method:this.addProduct}],tableConfigs:[],showCheckBox:!1,showIndex:!0},apiObj:{apiName:"listPageWarehouseOutDetails",params:{parentId:"null",fieldCode:"productCode,productName,productSpec,productGenreName,priceUnitName,priceCount,price,priceSum,remark"}},customColumn:[{columnIndex:"priceUnitName",width:"100",componentName:"select",_cellConfig:{asyn:{apiName:"findListProductUnitByProduct",params:{productId:""}},rules:[{required:!0}],outputData:!0}},{columnIndex:"priceCount",width:"120",componentName:"input",_cellConfig:{rules:[{greaterThan:["0",!1]},{regexp:"^[0-9]+([.]{1}[0-9]+){0,1}$"}],message:["计价数量必须大于零！","请输入大于零的整数或小数！"]}},{columnIndex:"price",width:"120",componentName:"input",_cellConfig:{rules:[{greaterThan:["0",!1]},{regexp:"^[0-9]+([.]{1}[0-9]+){0,1}$"}],message:["入库数量必须大于零！","请输入大于零的整数或小数！"]}},{columnIndex:"priceSum",componentName:"input",_cellConfig:{compute:"self@priceCount(*)self@price",editable:!1}},{columnIndex:"remark",width:"140",componentName:"input",_cellConfig:{}}],mergeTitle:[],mergeColumn:[],mergeRow:[],keyMapping:{},customSummary:{component:{props:["data","setStyle"],template:'<ul class="clearfix" :style="setStyle">\n                    <li style="float: left;width: 100%"><span>合计金额：</span><span>￥ {{data.total.toFixed(2)}}</span></li>\n                    </ul>'},boxStyle:{width:"250px",float:"left",padding:"10px"},apiObj:{apiName:"",params:{}},data:{total:"0.00"},computes:{total:"table@priceSum"}},typeData:{data:{selectUrl:"/system/dictionary/findListDictionaryByRoleMenu",selectParm:{dictionaryKey:"warehouseOutType",isglobal:"1",notInids:"'def4b13175dc44b08d7a0315b811700e'"}},defaultSelected:[]},DeptDialog:{showDialog:!1,visible:!1,dialog:{data:{isSingle:!0,title:"选择接收单位",tableUrl:"/base/departmentCustomer/listPageDepartmentCustomer",tableParm:{type:"5"},temp:{}},dialogName:"dialogOption"}},MakeDialog:{showDialog:!1,visible:!1,dialog:{data:{isSingle:!0,title:"选择制单人",tableUrl:"/system/user/listPageUsers",tableParm:{fieldCode:"code,name,mobile,email,deptName,remark"},temp:{}},dialogName:"dialogOption"}}}},created:function(){var e=this,t=this.$storage.get("userInfo");this.temp.makeId=t.userId,this.temp.makeName=t.userName,Object(n.findUserDepartmentByUser)({userId:this.temp.makeId}).then(function(t){null!=t.deptId&&t.deptId.trim().length>0&&(e.temp.deptId=t.deptId.trim()),null!=t.deptName&&t.deptName.trim().length>0&&(e.temp.deptName=t.deptName.trim())}),this.temp.warehouseName="实体库",this.temp.warehouseId="2d75e49bcb9911e884ad00163e105f05"},mounted:function(){this.isVisible=this.visible},computed:{dialogWidth:function(){if(this.initData.width){var e=s(this.initData.width);if("number"===e)return this.initData.width+"px";if("string"===e){var t=parseInt(this.initData.width);return t?t>100?"100%":t+"%":"300px"}return"300px"}return"300px"},fullscreen:function(){return!!this.initData.fullscreen},onModal:function(){return!!this.initData["close-on-click-modal"]},onEscape:function(){return!!this.initData["close-on-press-escape"]},dialogName:function(){return this.openDialogName}},methods:{databridge:function(e){this.isValidate=!0,Array.isArray(e)?(this.orderDtlList=[],this.orderDtlList=e):(this.productUnit=null,null!=e.item&&(this.productUnit=e.item),this.rowData=null,null!=e.item&&(this.rowData=e.row),this.setProductPrice(this.productUnit,this.rowData))},dialogOpen:function(){var e=this;this.$nextTick(function(){e.$refs.submitForm.clearValidate()})},dialogClose:function(e){this.$emit("close-dialog",e||{})},setProductPrice:function(e,t){null!=e&&null!=t&&(null!=e.id&&(t.priceUnit=e.id),null!=e.n2pFormula&&(t.n2pFormula=e.n2pFormula),null!=e.p2nFormula&&(t.p2nFormula=e.p2nFormula),t.n2pIsScale=e.n2pIsScale,t.n2pDecimalCount=e.n2pDecimalCount,t.p2nIsScale=e.p2nIsScale,t.p2nDecimalCount=e.p2nDecimalCount)},addProduct:function(){this.temp.warehouseId?(this.dialogData.isNeedWarehouseProduct="true",this.dialogData.warehouseId=this.temp.warehouseId,this.dialogData.data=this.tableData,this.dialogData.title="选择货品",this.openDialogName="productTableDialog",this.showDialog=!0,this.inLinVisible=!0):this.$message({type:"warning",duration:5e3,showClose:!0,message:"请先选择出库仓库！"})},save:function(){var e=this;this.$refs.submitForm.validate(function(t){t&&(e.isValidate=!1,e.$refs.orderAddDialog.getData(),e.isValidate&&e.saveWarehouseOut(e.orderDtlList))})},saveWarehouseOut:function(e){var t=this,a="";if(null!=e&&0!=e.length){for(var i=[],o=0;o<e.length;o++){var n=e[o],s={price:n.price,productId:n.productId,remark:n.remark,priceCount:n.priceCount,priceUnit:n.priceUnit,p2nFormula:n.p2nFormula,p2nIsScale:n.p2nIsScale,p2nDecimalCount:n.p2nDecimalCount};i.push(s)}null!=i&&i.length>0&&(a=JSON.stringify(i)),this.temp.dtlJsonStr=a,this.temp.type=this.typeData.defaultSelected[0],this.$refs.submitForm.validate(function(e){e&&(t.dialogLoading=!0,t.temp.warehouseDeptId=t.temp.deptId,Object(l.addWarehouseOutBySimple)(t.temp).then(function(e){t.dialogLoading=!1,0===e.code&&(t.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3}),t.isVisible=!1,t.dialogClose({resState:"ok"}))}).catch(function(e){}))})}else this.$message({type:"warning",duration:5e3,showClose:!0,message:"请至少选择一样货品！"})},typeSelect:function(e){e[0]?(this.temp.type=e[0],this.typeData.defaultSelected=[e[0]]):(this.temp.type=[],this.typeData.defaultSelected=[])},deptSelect:function(e){e[0]&&(this.temp.deptId=e[0].id,this.temp.deptName=e[0].name)},makeSelect:function(e){var t=this;e[0]&&(this.temp.makeId=e[0].id,this.temp.makeName=e[0].name,Object(n.findUserDepartmentByUser)({userId:this.temp.makeId}).then(function(e){null!=e.deptId&&e.deptId.trim().length>0&&(t.temp.deptId=e.deptId.trim()),null!=e.deptName&&e.deptName.trim().length>0&&(t.temp.deptName=e.deptName.trim())}))},closeDialog:function(e){this.showDialog=!1;var t=!1;null!=e.isConfirm&&(t=e.isConfirm);var a=[];null!=e.selectList&&(a=e.selectList),this.tableSelected(t,a)},tableSelected:function(e,t){if(e&&null!=t&&t.length>0)for(var a=0;a<t.length;a++){var i=t[a],o={productId:"",productCode:"",productName:"",productSpec:"",productGenreName:"",priceCount:"",price:"0.00",priceSum:"0.00"};o.productId=i.id.trim(),null!=i.code&&i.code.trim().length>0&&(o.productCode=i.code.trim()),null!=i.name&&i.name.trim().length>0&&(o.productName=i.name.trim()),null!=i.spec&&i.spec.trim().length>0&&(o.productSpec=i.spec.trim()),null!=i.genreName&&i.genreName.trim().length>0&&(o.productGenreName=i.genreName.trim()),o.priceUnit=i.unit,o.priceUnitName=i.unitName,o.n2pFormula=i.n2pFormula,o.n2pIsScale=i.n2pIsScale,o.n2pDecimalCount=i.n2pDecimalCount,o.p2nFormula=i.p2nFormula,o.p2nIsScale=i.p2nIsScale,o.p2nDecimalCount=i.p2nDecimalCount,this.tableData.push(o)}}},watch:{}},d=a("KHd+"),p=Object(d.a)(r,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{title:e.initData.title?e.initData.title:"",visible:e.isVisible,"append-to-body":e.inDialog,"close-on-click-modal":e.onModal,"close-on-press-escape":e.onEscape,fullscreen:e.fullscreen,width:"1000px"},on:{"update:visible":function(t){e.isVisible=t},open:e.dialogOpen,close:e.dialogClose}},[e.showDialog?a(e.dialogName,{tag:"component",attrs:{initData:e.dialogData,visible:e.inLinVisible},on:{"close-dialog":e.closeDialog,"table-selected":e.tableSelected}}):e._e(),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}]},[a("el-form",{ref:"submitForm",staticStyle:{"padding-top":"10px"},attrs:{rules:e.rules,model:e.temp,"label-position":"right","label-width":"120px"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"出库类型:",prop:"typeName"}},[a("base-input-select",{attrs:{data:e.typeData.data},on:{callback:e.typeSelect},model:{value:e.typeData.defaultSelected,callback:function(t){e.$set(e.typeData,"defaultSelected",t)},expression:"typeData.defaultSelected"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"业务单号:",prop:"businessCode"}},[a("el-input",{staticStyle:{width:"200px"},model:{value:e.temp.businessCode,callback:function(t){e.$set(e.temp,"businessCode",t)},expression:"temp.businessCode"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"接收单位:",prop:"deptName"}},[a("base-input-option",{staticStyle:{width:"200px"},attrs:{dialog:e.DeptDialog.dialog},on:{callback:e.deptSelect},model:{value:e.temp.deptName,callback:function(t){e.$set(e.temp,"deptName",t)},expression:"temp.deptName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"制单人:",prop:"makeName"}},[a("base-input-option",{staticStyle:{width:"200px"},attrs:{dialog:e.MakeDialog.dialog},on:{callback:e.makeSelect},model:{value:e.temp.makeName,callback:function(t){e.$set(e.temp,"makeName",t)},expression:"temp.makeName"}})],1)],1)],1)],1),e._v(" "),e.configs.topBarBtnList&&e.configs.topBarBtnList.length?a("el-row",{staticStyle:{"margin-left":"2%","margin-bottom":"10px"}},[e._l(e.configs.topBarBtnList,function(e,t){return[a("base-button",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"item.isShow"}],attrs:{name:e.name,icon:e.icon,plain:e.plain,state:e.state},on:{myclick:e.method}})]})],2):e._e(),e._v(" "),a("el-row",{staticStyle:{width:"96%","margin-left":"2%"}},[a("custom-base-table",{ref:"orderAddDialog",attrs:{"data-custom-table-id":"views_warehouseByWC_outByWC_dialogAddByPrice0",isSortable:!1,varList:e.tableData,keyValue:!1,showIndex:!0,showTableSet:!1,customColumn:e.customColumn,apiObj:e.apiObj,mergeTitle:e.mergeTitle,mergeColumn:e.mergeColumn,mergeRow:e.mergeRow,componentId:"orderAddDialog",useDefaultBtn:!0,showAll:!1,keyMapping:e.keyMapping,useSummary:!0,customSummary:e.customSummary},on:{databridge:e.databridge}})],1),e._v(" "),a("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center","padding-bottom":"10px"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")]),e._v(" "),a("el-button",{on:{click:function(t){e.isVisible=!1}}},[e._v("关闭")])],1)],1)],1)},[],!1,null,null,null);p.options.__file="dialogAddByPrice.vue";t.default=p.exports}}]);