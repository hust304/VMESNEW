(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1bd7"],{"8q5K":function(t,e,a){},Ic6b:function(t,e,a){"use strict";a.r(e);a("rGqo"),a("yt8O"),a("XfO3"),a("9AAn");var i=a("2+ib"),n=a("uTIz"),o=a("uhSg"),s=a("hmHw"),l=a("rny0"),r=a("uIi3"),d=a("Gr86"),c=a("AUoE"),u=a("OsNz"),h=a("Vobf"),p={components:{multilevelTable:i.a,searchBar:n.a,dialogEdit:o.default,dialogDetailEditByPrice:s.default,dialogDeliverDtl:l.default,dialogWarehouseOutByDeliver:r.default,dialogDeliverInfo:d.default},data:function(){return{deliverStateNameMap:new Map([["0","待发货"],["1","已发货"],["-1","已取消"]]),outStateNameMap:new Map([["0","未完成"],["1","已完成"],["-1","已取消"]]),searchList:[{label:"发货单号",type:"input",ruleType:"string",mapKey:"deliverCode",configs:{},placeholder:"发货单编号"},{label:"订单编号",type:"input",ruleType:"string",mapKey:"orderCode",configs:{},placeholder:"订单编号"},{label:"客户名称",type:"input",ruleType:"string",mapKey:"customerName",configs:{},placeholder:"客户名称"},{label:"发货状态",type:"select",ruleType:"string",mapKey:"detailState",configs:{clearable:!0,name:"",options:[{value:"0",label:"待发货"},{value:"1",label:"已发货"},{value:"-1",label:"已取消"}]},placeholder:"请选择"},{label:"结算状态",type:"select",ruleType:"string",mapKey:"sumState",configs:{clearable:!0,name:"",options:[{value:"",label:"全部"},{value:"1",label:"已结算"},{value:"0",label:"未结算"}]},placeholder:"请选择"},{label:"发货日期起",type:"date",ruleType:"date",mapKey:"deliverDateBegin",configs:{clearable:!0,name:"",type:"date",pickerOptions:{}},placeholder:"请选择"},{label:"发货日期止",type:"date",ruleType:"date",mapKey:"deliverDateEnd",configs:{clearable:!0,name:"",type:"date",pickerOptions:{}},placeholder:"请选择"}],guid:"",tableConfigList:[{customColumn:[{columnIndex:"deliverCode",_cellConfig:{hideTitle:!0},width:"110"},{columnIndex:"makeName",_cellConfig:{hideTitle:!0},width:"90"},{columnIndex:"pieceCount",_cellConfig:{hideTitle:!0},width:"50"},{columnIndex:"totalSum",_cellConfig:{hideTitle:!0},width:"100"},{columnIndex:"state",width:"80",componentName:"tag",_cellConfig:{success:{state:"1",text:"已发货"},default:{state:"0",text:"待发货"},info:{state:"-1",text:"已取消"}}},{columnIndex:"outState",width:"80",componentName:"tag",_cellConfig:{success:{state:"1",text:"已完成"},default:{state:"0",text:"未完成"},info:{state:"-1",text:"已取消"}}},{columnIndex:"last",prop:"operate",label:"操作",componentName:"button",width:"200",component:[{name:"取消",nameEn:"cancelByParent",editBtns_isShow:!0,rowState:"#self@state#===0 && (#self@isShowOut#==0 && #self@isShowDeliver#==0)",method:this.cancelByParent},{name:"出库详情",nameEn:"infoOutByParent",editBtns_isShow:!0,rowState:"#self@isShowOut#===1",method:this.infoOutByParent},{name:"发货详情",nameEn:"infoByParent",editBtns_isShow:!0,rowState:"#self@isShowDeliver#==1",method:this.infoByParent},{name:"打印",nameEn:"printByParent",editBtns_isShow:!0,rowState:"#self@isShowDeliver#==1",method:this.printByParent}]}],apiObj:{apiName:"listPageSaleDeliver",params:{fieldCode:"deliverCode,makeName,customerName,deliverDate,pieceCount,totalSum,remark,state,outState",isNeedOutId:"true",isNeedInfo:"true",priceType:"2",dataType:this.$storage.get("dataType"),orderStr:"deliver.deliver_code desc"}},tempData:{},showHeader:!0,showIndex:!1,showCheckBox:!0,isSingle:!0,showTableSet:!1,showAll:!1,componentId:"oneLevelTable",expand:!0,expandMode:"none",showExpandBtn:!0,rowStyle:{"background-color":"#dfe6ec"},buttonStyle:{padding:0,margin:10}},{customColumn:[{columnIndex:"prodInfo",width:"200",_cellConfig:{hideTitle:!0}}],apiObj:{apiName:"listPageSaleDeliverDetail",params:{fieldCode:"sysOrderCode,prodInfo,orderUnitName,orderCount,productPrice,sum,sumStateName,pieceCountPage",addColumn:{columnKey:"prodInfo",columnName:"货品"},prodColumnKey:"productCode,productName,productSpec,productProperty",isNeedPage:"false"}},dynamicValue:{parentId:"self@id"},tempData:{},showIndex:!0,showCheckBox:!1,isSingle:!1,leftFixed:4,rightFixed:0,componentId:"twoLevelTable"}],searchObj:{},selectList:[],configs:{topBarBtnList:[{name:"发货",nameEn:"dialogAdd",isShow:!0,state:!1,icon:"add",method:this.dialogAdd}],tableConfigs:[],showCheckBox:!1},temp:{},openDialogName:"",showDialog:!1,visible:!1,dialogData:{title:"",deliverId:"",customerId:"",temp:null,tempLable:null}}},beforeCreate:function(){},created:function(){this.initButtons()},beforeMount:function(){},mounted:function(){},beforeUpdate:function(){},updated:function(){},methods:{initButtons:function(){var t=this,e=t.$storage.get("userInfo").roleIds,a=t.$storage.get("menuId");e&&(t.$loading({spinner:"preloader",text:""}),Object(h.initMenuButtons)({menuId:a,roleId:e}).then(function(e){t.$loading().close();var a=e.buttonList;a&&a.forEach(function(e){t.configs&&(t.configs.queryBarBtnList&&t.configs.queryBarBtnList.forEach(function(t){t.nameEn==e.nameEn&&(t.isShow=!1)}),t.configs.topBarBtnList&&t.configs.topBarBtnList.forEach(function(t){t.nameEn==e.nameEn&&(t.isShow=!1)})),t.tableConfigList&&t.tableConfigList.forEach(function(t){t.customColumn&&t.customColumn.forEach(function(t){"last"==t.columnIndex&&t.component&&t.component.forEach(function(t){t.nameEn==e.nameEn&&(t.rowState="1==2")})})})})}).catch(function(e){t.$loading().close()}))},databridge:function(t){this.temp.dataList=t,this.selectList=t,this.configs.topBarBtnList.forEach(function(t){"dialogAdd"==t.nameEn&&(t.state=!1)});var e=!1;if(null!=t&&t.length>0)for(var a=0;a<t.length;a++){if("0"!=t[a].state){e=!0;break}}e&&this.configs.topBarBtnList.forEach(function(t){"dialogAdd"==t.nameEn&&(t.state=!0)})},getData:function(){this.$refs.customBaseTable.getData()},pushData:function(t,e){this.$refs.customBaseTable.pushData(t,e)},updateData:function(t){this.selectList=[],this.$refs.customBaseTable.updateData(t)},deleteData:function(t){this.$refs.customBaseTable.deleteData(t)},callMethod:function(t){t&&t.methodName&&this[t.methodName](t.params)},sendGuid:function(t){this.guid=t},searchMap:function(t){this.searchObj=t,this.updateData(this.searchObj)},resetTemp:function(){for(var t in this.temp)this.temp[t]=""},closeDialog:function(t){this.showDialog=!1,"ok"===t.resState&&this.updateData(this.searchObj)},dialogAdd:function(){if(null==this.selectList||0==this.selectList.length||this.selectList.length>1)this.$message({type:"warning",duration:5e3,showClose:!0,message:"请选择一条发货单数据，只允许单选！"});else{var t=this.selectList[0].state;if("1"!=t&&"-1"!=t){var e=this.selectList[0].outState;"1"==e?"1"==e&&this.checkIsNullDeliverSumByDeliverId(this.selectList[0]):this.$message({type:"warning",duration:5e3,showClose:!0,message:"该发货单出库状态("+this.outStateNameMap.get(e)+")，不可执行(发货)操作！"})}else this.$message({type:"warning",duration:5e3,showClose:!0,message:"该发货单状态("+this.deliverStateNameMap.get(t)+")，不可执行(发货)操作！"})}},infoOutByParent:function(t){this.dialogData.temp=JSON.parse(JSON.stringify(t)),this.dialogData.title="出库详情",this.openDialogName="dialogWarehouseOutByDeliver",this.showDialog=!0,this.visible=!0},infoByParent:function(t,e){this.dialogData.temp=JSON.parse(JSON.stringify(t)),this.dialogData.title="发货详情",this.openDialogName="dialogDeliverInfo",this.showDialog=!0,this.visible=!0},printDeliverBill:function(t,e){var a=new Date,i="<!DOCTYPE html>";if(i+="<html>",i+="\t<head>",i+='\t\t<meta charset="UTF-8">',i+="\t\t<title></title>",i+='\t\t<style type="text/css">',i+="\t\t\ttr{",i+="\t\t\t\theight: 50px;",i+="\t\t\t}",i+="\t\t</style>",i+="\t</head>",i+="\t<body>",i+='\t\t<h2 style="text-align: center;">'+e.companyName+"发货单</h2>",i+="\t\t<p><span>收货单位："+e.customerName+"</span>",i+='\t\t<span style="float: right;">'+a.getFullYear()+"&nbsp;年&nbsp;"+(a.getMonth()+1)+"&nbsp;月&nbsp;"+a.getDate()+"&nbsp;日</span></p>",i+='\t\t<table width="100%">',i+="\t\t\t<tr>","1"==e.type?(i+="\t\t\t\t<td>发货方式："+e.typeName+"</td>",i+="\t\t\t\t<td>发货件数："+e.pieceCount+"</td>",i+="\t\t\t\t<td>物流公司："+e.waybillCompany+"</td>",i+="\t\t\t\t<td>物流单号："+e.waybillCode+"</td>"):"2"==e.type?(i+="\t\t\t\t<td>发货方式："+e.typeName+"</td>",i+="\t\t\t\t<td>发货件数："+e.pieceCount+"</td>",i+="\t\t\t\t<td>送货车号："+e.carCode+"</td>"):"3"==e.type&&(i+="\t\t\t\t<td>发货方式："+e.typeName+"</td>",i+="\t\t\t\t<td>发货件数："+e.pieceCount+"</td>",i+="\t\t\t\t<td>车牌号："+e.carCode+"</td>"),i+="\t\t\t</tr>",i+="\t\t\t<tr>",i+="\t\t\t\t<td>备注："+e.remark+"</td>",i+="\t\t\t</tr>",i+="\t\t</table>",i+='\t\t<table width="100%" border="1px" cellspacing="0" style="border: 1px solid  darkgray;text-align: center;">',i+="\t\t\t<tr>",i+="\t\t\t\t<td>订单编号</td>",i+="\t\t\t\t<td>货品编码</td>",i+="\t\t\t\t<td>货品名称</td>",i+="\t\t\t\t<td>规格型号</td>",i+="\t\t\t\t<td>图号</td>",i+="\t\t\t\t<td>单位</td>",i+="\t\t\t\t<td>数量</td>",i+="\t\t\t\t<td>件数</td>",i+="\t\t\t</tr>",t.length>0)for(var n=0;n<t.length;n++){var o=t[n];i+="\t\t\t<tr>",i+="\t\t\t\t<td>"+o.sysOrderCode+"</td>",i+="\t\t\t\t<td>"+o.productCode+"</td>",i+="\t\t\t\t<td>"+o.productName+"</td>",i+="\t\t\t\t<td>"+o.productSpec+"</td>",i+="\t\t\t\t<td>"+o.pictureCode+"</td>",i+="\t\t\t\t<td>"+o.orderUnitName+"</td>",i+="\t\t\t\t<td>"+o.orderCount+"</td>",i+="\t\t\t\t<td>"+o.pieceCount+"</td>",i+="\t\t\t</tr>"}i+="\t\t</table>",i+='\t\t<table width="100%">',i+="\t\t\t<tr>",i+='\t\t\t\t<td style="float:left">收货单位经手人：</td>',i+='\t\t\t\t<td style="float:right;padding-right: 100px">送货单位经手人：</td>',i+="\t\t\t</tr>",i+="\t\t</table>",i+="\t</body>",i+="</html>";var s=window.open("","打印","");s.document.write(i),s.document.close(),s.focus(),s.print(),s.close()},printByParent:function(t,e){var a=this;Object(u.listPageSaleDeliverDetail)({parentId:t.parentId}).then(function(e){var i=e.result.varList;a.printDeliverBill(i,t)}).catch(function(t){})},cancelByParent:function(t,e){var a=this;this.$confirm("此操作将发货单状态变更为已取消, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(c.cancelSaleDeliver)(t.id).then(function(t){0===t.code&&(a.$notify({title:"成功",message:"操作成功",type:"success",duration:2e3}),a.updateData(a.searchObj))}).catch(function(t){})}).catch(function(){a.$message({type:"info",message:"已取消操作"})})},checkIsNullDeliverSumByDeliverId:function(t){var e=this,a=t.id;Object(c.checkIsNullDeliverSumByDeliverId)({deliverId:a}).then(function(a){if(0==a.code){if(null!=a.isNullDeliverSum&&"true"==a.isNullDeliverSum)return void e.$message({type:"warning",duration:5e3,showClose:!0,message:"当前发货单金额为空，请先执行核价功能！ 提示:销售-发货管理-发货核价"});e.showDialogByDeliver(t)}}).catch(function(t){})},showDialogByDeliver:function(t){this.dialogData.rowData=JSON.parse(JSON.stringify(t)),this.dialogData.title="发货件数",this.openDialogName="dialogDeliverDtl",this.showDialog=!0,this.visible=!0}},computed:{tableHeight:function(){return this.$store.getters[this.guid+"/clientData"]?this.$store.getters[this.guid+"/clientData"].clientHeight-(this.searchList.length?this.$store.getters[this.guid+"/dynaHeight"]+30-this.$store.getters[this.guid+"/arrowBtn"]:0):0},dialogName:function(){return this.openDialogName}},watch:{}},m=(a("J2vl"),a("xAgo"),a("KHd+")),g=Object(m.a)(p,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"createDeliver"},[t.searchList.length?a("search-bar",{attrs:{searchList:t.searchList},on:{"search-map":t.searchMap,"send-guid":t.sendGuid}}):t._e(),t._v(" "),a("el-row",{staticClass:"tableTopBar"},[a("el-col",[a("div",{staticClass:"tableBtns"},[t._l(t.configs.topBarBtnList,function(t,e){return[a("base-button",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"item.isShow"}],attrs:{name:t.name,icon:t.icon,plain:t.plain,state:t.state},on:{myclick:t.method}})]})],2)])],1),t._v(" "),a("el-row",{staticStyle:{border:"1px solid #E4E4E4","border-bottom":"none","margin-top":"10px",transition:"height 0.4s","-webkit-transition":"height 0.4s","-moz-transition":"height 0.4s"},style:{height:t.tableHeight+"px"}},[a("el-col",{staticClass:"tableStyle"},[a("div",{staticClass:"baseTable"},[a("el-row",{staticClass:"tableContent"},[a("multilevel-table",{ref:"customBaseTable",attrs:{"data-custom-table-id":"views_sale_deliver_listDeliverByPrice_index0",tableConfigList:t.tableConfigList},on:{callmethod:t.callMethod,databridge:t.databridge}})],1)],1)])],1),t._v(" "),t.showDialog?a(t.dialogName,{tag:"component",attrs:{initData:t.dialogData,visible:t.visible},on:{"close-dialog":t.closeDialog}}):t._e()],1)},[],!1,null,null,null);g.options.__file="index.vue";e.default=g.exports},J2vl:function(t,e,a){"use strict";var i=a("hwtz");a.n(i).a},hwtz:function(t,e,a){},xAgo:function(t,e,a){"use strict";var i=a("8q5K");a.n(i).a}}]);