(window.webpackJsonp=window.webpackJsonp||[]).push([["HSjz"],{HSjz:function(e,t,a){"use strict";a.r(t);a("f3/d");var i=a("2+ib"),n=(a("UHWX"),{components:{multilevelTable:i.a},props:["initData","visible"],data:function(){return{signDtlId:"",tableData:[],tableConfigList:[{customColumn:[{columnIndex:"qualityTypeName",width:"100",componentName:"select",_cellConfig:{hideTitle:!0,options:[{id:"全检",label:"全检"},{id:"抽检",label:"抽检"}]}},{columnIndex:"qualityCount",width:"120",componentName:"input",_cellConfig:{rules:[{required:!0},{regexp:"^[0-9]+([.]{1}[0-9]+){0,1}$"},{greaterThan:["0",!1]}],message:["不可为空！","请输入大于零的整数或小数","不可等于零！"]}},{columnIndex:"badCount",width:"120",componentName:"input",_cellConfig:{rules:[{required:!0},{regexp:"^[0-9]+([.]{1}[0-9]+){0,1}$"}],message:["不可为空！","请输入大于零的整数或小数"]}},{columnIndex:"retreatCount",width:"120",componentName:"input",_cellConfig:{rules:[{required:!0},{regexp:"^[0-9]+([.]{1}[0-9]+){0,1}$"}],message:["不可为空！","请输入大于零的整数或小数"]}},{columnIndex:"receiveCount",width:"120",componentName:"input",_cellConfig:{rules:[{required:!0},{regexp:"^[0-9]+([.]{1}[0-9]+){0,1}$"}],message:["不可为空！","请输入大于零的整数或小数"]}}],apiObj:{apiName:"listPagePurchaseSignDetailByQualityExecute",params:{fieldCode:"productCode,productName,productSpec,productProperty,orderUnitName,qualityTypeName,arriveCount,qualityCount,badCount,retreatCount,receiveCount,",signDtlId:""}},tempData:{},showHeader:!0,showCheckBox:!1,showTableSet:!1,showAll:!1,componentId:"oneLevelTable",expand:!0,expandMode:"all",rowStyle:{"background-color":"#dfe6ec"}},{customColumn:[{columnIndex:"badCount",componentName:"input",_cellConfig:{rules:[{required:!0},{regexp:"^[0-9]+([.]{1}[0-9]+){0,1}$"}],message:["不可为空！","请输入大于零的整数或小数"]}}],apiObj:{apiName:"listPagePurchaseQualityDetailByQualityExecute",params:{fieldCode:"qualityName,qualityCriterion,badCount",isNeedPage:"false"}},dynamicValue:{signDetailId:"self@id"},tempData:{},showIndex:!1,showCheckBox:!1,isSingle:!1,componentId:"twoLevelTable",leftFixed:1,rightFixed:1}],openDialogName:"",showDialog:!1,inLinVisible:!1,dialogData:{title:""},dialogLoading:!1,isVisible:!1,inDialog:!0}},beforeCreate:function(){},created:function(){this.signDtlId=this.initData.rowData.id,this.tableConfigList[0].apiObj.params.signDtlId=this.initData.rowData.id},beforeMount:function(){},mounted:function(){this.dialogLoading=!1,this.isVisible=this.visible},beforeUpdate:function(){},updated:function(){},computed:{fullscreen:function(){return!!this.initData.fullscreen},onModal:function(){return!!this.initData["close-on-click-modal"]},onEscape:function(){return!!this.initData["close-on-press-escape"]},dialogName:function(){return this.openDialogName}},methods:{callMethod:function(e){e&&e.methodName&&this[e.methodName](e.params)},dialogOpen:function(){},dialogClose:function(e){this.$emit("close-dialog",e||{})},getData:function(){this.$refs.customBaseTable.getData()},databridge:function(e){this.tableData=e},pushData:function(e,t){this.$refs.customBaseTable.pushData(e,t)},deleteData:function(e){this.$refs.customBaseTable.deleteData(e)},closeDialog:function(e,t,a){var i=this.findExecuteCountByParentData(t);if("close"!=a){var n={id:"",detailId:"",executorId:"",executorName:"",warehouseId:"",pathName:"",stockCount:null,count:null};if(null!=e&&e.length>0){n.executorId=this.$storage.get("userInfo").userId,n.executorName=this.$storage.get("userInfo").userName,n.detailId=t.id;var o=e[0];n.id=o.id,n.warehouseId=o.warehouseId,n.name=o.name,n.stockCount=o.stockCount,n.count=t.count/1-i+"",this.pushData(n,t)}}this.showDialog=!1},findExecuteCountByParentData:function(e){var t=0;if(null==e||null==e.children||0==e.children.length)return t;for(var a=e.children,i=0;i<a.length;i++){var n=a[i].count+"";null!=n&&n.trim().length>0&&this.isNumberByValue(n.trim())&&(t+=n.trim()/1)}return t},deleteRow:function(e){this.deleteData(e)},checkColumnByFirst:function(e){for(var t="",a=0;a<e.length;a++){var i=e[a],n=i.qualityType,o=i.arriveCount,l=i.qualityCount;"1"==n&&l/1-o/1!=0?t+="检验方式(全检) 实检数必须与签收数相等！":"2"==n&&l/1-o/1>0&&(t+="检验方式(抽检) 实检数不可大于签收数！");var s=i.badCount/1;i.retreatCount/1+i.receiveCount/1-s!=0&&(t+="不合格数必须等于(退货数+让步接收)！")}return t},checkColumnBySecond:function(e){for(var t="",a=0;a<e.length;a++){var i=e[a],n=i.badCount/1,o=0,l=0,s=i.children;if(null!=s&&s.length>0)for(var r=0;r<s.length;r++){var u=s[r].badCount/1;l+=u,0==r?o=u:r>0&&u<o&&(o=u)}l>0&&n<o?t=t+"不合格数不可小于"+o+"！":l>0&&l<n&&(t+="检验不合格总和不可小于不合格数！")}return t},findJsonStringByTable:function(e){for(var t=[],a=0;a<e.length;a++){for(var i=e[a],n={id:i.id,qualityType:"",qualityCount:i.qualityCount,badCount:i.badCount,retreatCount:i.retreatCount,receiveCount:i.receiveCount,children:""},o=[],l=i.children,s=0;s<l.length;s++){var r=l[s],u={id:r.id,badCount:r.badCount};o.push(u)}n.children=o,t.push(n)}return JSON.stringify(t)},save:function(){this.getData(),null!=this.tableData&&this.tableData.length>0&&this.addWarehouseInExecute(this.tableData)},addWarehouseInExecute:function(e){var t=this.checkColumnByFirst(e);if(null!=t&&t.trim().length>0)this.$message({type:"warning",duration:5e3,showClose:!0,message:t});else if(null!=(t=this.checkColumnBySecond(e))&&t.trim().length>0)this.$message({type:"warning",duration:5e3,showClose:!0,message:t});else{console.log("提交保存");this.findJsonStringByTable(tableDataArry)}}},watch:{}}),o=a("KHd+"),l=Object(o.a)(n,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{title:e.initData.title?e.initData.title:"",visible:e.isVisible,"append-to-body":e.inDialog,"close-on-click-modal":e.onModal,"close-on-press-escape":e.onEscape,fullscreen:e.fullscreen,width:"1200px"},on:{"update:visible":function(t){e.isVisible=t},open:e.dialogOpen,close:e.dialogClose}},[e.showDialog?a(e.dialogName,{tag:"component",attrs:{initData:e.dialogData,visible:e.inLinVisible},on:{"close-dialog":e.closeDialog}}):e._e(),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],staticStyle:{"padding-top":"10px"}},[a("el-row",{staticStyle:{width:"96%","margin-left":"2%","margin-bottom":"5px",border:"1px solid #E4E4E4","border-bottom":"none"}},[a("multilevel-table",{ref:"customBaseTable",attrs:{"data-custom-table-id":"views_quality_purchaseSignByQuality_dialogExecute0",tableConfigList:e.tableConfigList},on:{callmethod:e.callMethod,databridge:e.databridge}})],1),e._v(" "),a("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center","padding-bottom":"10px"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")]),e._v(" "),a("el-button",{on:{click:function(t){e.isVisible=!1}}},[e._v("关闭")])],1)],1)],1)},[],!1,null,null,null);l.options.__file="dialogExecute.vue";t.default=l.exports}}]);